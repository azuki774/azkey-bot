version: '3.8'

services:
  azkey-bot-roumu:
    build: .
    environment:
      # Misskey access token (required)
      - i=${MISSKEY_TOKEN}
      # OpenRouter API key (required)
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      # CSV data directory
      - ROUMU_DATA_DIR=/app/data
    volumes:
      # Persistent storage for CSV data
      - ./data:/app/data
    restart: unless-stopped
    # Override default command
    command: status

  # Follow back service (runs every hour)
  follow-service:
    build: .
    environment:
      - i=${MISSKEY_TOKEN}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - ROUMU_DATA_DIR=/app/data
    volumes:
      - ./data:/app/data
    restart: unless-stopped
    command: follow
    # Note: For production, use a proper scheduler like cron or Kubernetes CronJob

  # Timeline check service (runs every 5 minutes)
  check-service:
    build: .
    environment:
      - i=${MISSKEY_TOKEN}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - ROUMU_DATA_DIR=/app/data
    volumes:
      - ./data:/app/data
    restart: unless-stopped
    command: check
    # Note: For production, use a proper scheduler like cron or Kubernetes CronJob

volumes:
  data:
    driver: local